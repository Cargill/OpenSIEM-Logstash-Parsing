input {
  pipeline {
    address => VAR_PIPELINE_NAME
  }
}
filter {
  grok {
    match => {
      "message" => "%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:syslog_hostname}\s.*\[%{WORD:product}\]\:\s%{WORD:day},\s%{GREEDYDATA:date}\s-%{INT:value}\|%{WORD:status}\|%{WORD:infotype}\|%{WORD:messagetype}\|%{WORD:errorlevel}\|%{GREEDYDATA:finalmessage}"
    }
  }
  mutate {
    rename => {"syslog_hostname" => "host.hostname"}
    rename => {"date" => "event.created"}
    rename => {"status" => "event.action"}
    rename => {"messagetype" => "error.code"}
    rename => {"infotype" => "error.id"}
    rename => {"finalmessage" => "event.outcome"}
    rename => {"product" => "observer.product"}
    add_field => { "event.module" => "Tenable" }
  }
  date {
    match => [ "event.created", "dd MMM yyyy HH:mm:ss", "ISO8601" ]
    timezone => "GMT"
    locale => "en"
    target => "event.created"
    tag_on_failure => "_dateparsefailure_ec"
  }

  if "_dateparsefailure_ec" in [tags]  {
    if ![log.orignal] {
      mutate {
        copy => { "message" => "log.original" }
      }
    }
    mutate {
     remove_field => ["event.created"]
    }
  }
}
output {
  pipeline { send_to => [enrichments] }
}